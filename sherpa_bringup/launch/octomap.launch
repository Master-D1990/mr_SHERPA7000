<?xml version="1.0"?>
<!-- 
  Launch file for OctoMap server with configurable parameters
  This file provides a configurable OctoMap server setup for 3D voxel mapping
-->
<launch>
  <!-- Arguments -->
  <arg name="frame_id" default="map" doc="Coordinate frame for the resulting map"/>
  <arg name="resolution" default="0.05" doc="Resolution of the octree map in meters"/>
  <arg name="sensor_model_max_range" default="5.0" doc="Maximum range for sensor measurements"/>
  <arg name="sensor_model_hit" default="0.7" doc="Hit probability for sensor model"/>
  <arg name="sensor_model_miss" default="0.4" doc="Miss probability for sensor model"/>
  <arg name="sensor_model_min" default="0.12" doc="Minimum probability for occupied cells"/>
  <arg name="sensor_model_max" default="0.97" doc="Maximum probability for occupied cells"/>
  <!-- Set default topic to /rslidar_points which is actively publishing data -->
  <arg name="pointcloud_topic" default="/rslidar_points" doc="Topic for incoming point cloud data"/>
  <arg name="filter_ground" default="true" doc="Whether to filter out ground plane"/>
  <arg name="ground_filter_distance" default="0.04" doc="Distance threshold for ground plane points"/>
  <arg name="ground_filter_angle" default="0.15" doc="Angle threshold for ground plane detection"/>
  <arg name="ground_filter_plane_distance" default="0.07" doc="Max distance from ground plane"/>
  <arg name="compress_map" default="true" doc="Whether to use lossless compression for the map"/>
  <arg name="incremental_2d_projection" default="false" doc="Whether to incrementally update the 2D map projection"/>
  <arg name="occupancy_min_z" default="-100.0" doc="Minimum height for occupied cells in 2D projection"/>
  <arg name="occupancy_max_z" default="100.0" doc="Maximum height for occupied cells in 2D projection"/>

  <!-- Launch octomap server -->
  <node pkg="octomap_server" type="octomap_server_node" name="octomap_server" output="screen">
    <param name="frame_id" value="$(arg frame_id)"/>
    <param name="resolution" value="$(arg resolution)"/>
    <param name="sensor_model/max_range" value="$(arg sensor_model_max_range)"/>
    <param name="sensor_model/hit" value="$(arg sensor_model_hit)"/>
    <param name="sensor_model/miss" value="$(arg sensor_model_miss)"/>
    <param name="sensor_model/min" value="$(arg sensor_model_min)"/>
    <param name="sensor_model/max" value="$(arg sensor_model_max)"/>
    <param name="filter_ground" value="$(arg filter_ground)"/>
    <param name="ground_filter/distance" value="$(arg ground_filter_distance)"/>
    <param name="ground_filter/angle" value="$(arg ground_filter_angle)"/>
    <param name="ground_filter/plane_distance" value="$(arg ground_filter_plane_distance)"/>
    <param name="compress_map" value="$(arg compress_map)"/>
    <param name="incremental_2D_projection" value="$(arg incremental_2d_projection)"/>
    <param name="occupancy_min_z" value="$(arg occupancy_min_z)"/>
    <param name="occupancy_max_z" value="$(arg occupancy_max_z)"/>
    <remap from="cloud_in" to="$(arg pointcloud_topic)"/>
  </node>
</launch>