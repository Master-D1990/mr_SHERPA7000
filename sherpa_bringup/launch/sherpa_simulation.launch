<?xml version="1.0"?>
<!-- 
  Haupt-Launch-Datei für die SHERPA-Simulation
  Diese Datei startet die gesamte Simulationsumgebung einschließlich:
  - Gazebo mit Sherpa-Roboter und LiDAR
  - Tastatur-Teleop-Steuerung
  - 3D Voxel Mapping mit OctoMap-Visualisierung
-->
<launch>
  <!-- Allgemeine Argumente -->
  <arg name="debug" default="false" doc="Gazebo im Debug-Modus starten"/>
  <arg name="gui" default="true" doc="Gazebo GUI anzeigen"/>
  <arg name="use_rviz" default="true" doc="RViz starten für die Roboter-Visualisierung"/>

  <!-- Deaktiviere den zweiten LiDAR, um nur den RPLiDAR zu verwenden -->
  <arg name="laser_enabled" default="false" doc="Zweiten LiDAR (Velodyne) aktivieren/deaktivieren"/>
  <!-- RPLiDAR Parameter -->
  <arg name="rplidar_enabled" default="true" doc="RPLiDAR in der Simulation aktivieren"/>
  <!-- Mapping-Parameter -->
  <arg name="enable_mapping" default="true" doc="2D-Mapping-Funktionalität aktivieren"/>
  <arg name="mapping_type" default="gmapping" doc="Mapping-Typ: 'gmapping', 'hector' oder 'cartographer'"/>
  <arg name="localization_only" default="false" doc="True für reine Lokalisierung in einer bestehenden Karte"/>
  
  <!-- Roboter-Startposition -->
  <arg name="x" default="0.0"/>
  <arg name="y" default="0.0"/>
  <arg name="z" default="0.4"/>
  <arg name="roll" default="0.0"/>
  <arg name="pitch" default="0.0"/>
  <arg name="yaw" default="0.0"/>
  
  
  <!-- Neue Synchronisations-Parameter -->
  <arg name="use_synchronization" default="true" doc="Synchronisation zwischen Scans und TF aktivieren"/>
  <arg name="max_sync_delay" default="0.1" doc="Maximale erlaubte Verzögerung für Synchronisation (s)"/>
  
  <!-- 1. Starte Gazebo mit dem Sherpa-Roboter -->
  <include file="$(find sherpa_gazebo)/launch/sherpa_gazebo.launch">
    <arg name="debug" value="$(arg debug)"/>
    <arg name="run_gui" value="$(arg gui)"/>
    <arg name="x" value="$(arg x)"/>
    <arg name="y" value="$(arg y)"/>
    <arg name="z" value="$(arg z)"/>
    <arg name="roll" value="$(arg roll)"/>
    <arg name="pitch" value="$(arg pitch)"/>
    <arg name="yaw" value="$(arg yaw)"/>
    <arg name="laser_enabled" value="$(arg laser_enabled)"/>
    <arg name="start_teleop" value="false"/>
  </include>
  
  <!-- Starte RPLiDAR-Integration für die Simulation -->
  <group if="$(arg rplidar_enabled)">
    <include file="$(find rplidar_ros)/launch/sherpa_rplidar_sim.launch" />
  </group>

  <!-- 2. Starte Tastatur-Teleop-Steuerung -->
  <include file="$(find sherpa_teleop)/launch/sherpa_teleop.launch" />

  <!-- 3. Starte das 2D-Mapping mit dem sherpa_mapping-Paket -->
  <group if="$(arg enable_mapping)">
    <include file="$(find sherpa_mapping)/launch/mapping.launch">
      <!-- Konfiguration für das Mapping -->
      <arg name="mode" value="$(eval 'localization' if localization_only else 'mapping')"/>
      <arg name="scan_topic" value="/scan"/>
      <arg name="use_rviz" value="true"/> <!-- RViz für das 2D-Mapping starten -->
      <arg name="particles" value="60"/> <!-- Optimiert für Raupenfahrzeug -->
    </include>
  </group>

</launch>